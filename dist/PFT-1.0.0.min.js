/*! PFT v1.0.0, created by: Jason Holt Smith <bicarbon8@gmail.com> 2015-01-23 15:42:24 */
var PFT={};PFT.POLLING_INTERVAL=1e3,PFT.DEFAULT_TIMEOUT=6e4,PFT.IMAGES_DIR="./img/",PFT.createPage=function(a,b){PFT.debug("generating new page...");var c=null;if(c=PFT.webpage.create(),a||(a={width:1024,height:800}),PFT.debug("setting viewport to: "+JSON.stringify(a)),c.viewportSize=a,b){PFT.debug("setting headers to: "+JSON.stringify(b));for(var d=0;d<b.length;d++){var e=b[d];c=PFT.addHeader(c,e.name,e.value)}}return c},PFT.addHeader=function(a,b,c){var d=a.customHeaders;return d||(d={}),d[b]=c,a.customHeaders=d,a},PFT.getCookieValue=function(a){PFT.debug("checking for cookie '"+a+"' in cookies...");for(var b in phantom.cookies){var c=phantom.cookies[b];if(c.name.toLowerCase()==a.toLowerCase())return PFT.debug("found '"+a+"' cookie with value of: '"+c.value+"'"),c.value}},PFT.trace=function(a){PFT.Logger.log(PFT.Logger.TRACE,a,!0)},PFT.debug=function(a){PFT.Logger.log(PFT.Logger.DEBUG,a)},PFT.info=function(a){PFT.Logger.log(PFT.Logger.INFO,a)},PFT.warn=function(a){PFT.Logger.log(PFT.Logger.WARN,a)},PFT.error=function(a,b){PFT.Logger.log(PFT.Logger.ERROR,a,!0),b&&b.renderPage()},PFT.guid=function(){function a(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()},PFT.convertMsToHumanReadable=function(a){var b=new Date(a),c=b.getHours(),d=b.getMinutes(),e=b.getSeconds(),f=b.getMilliseconds(),g="";return c>0&&(g+=c,g+=1==c?" hour ":" hours "),d>0&&(g+=d,g+=1==d?" minute ":" minutes "),e>0&&(g+=e,g+=1==e?" second ":" seconds "),f>0&&(g+=f,g+=1==f?" millisecond":" milliseconds"),g};var PFT=PFT||{};PFT.PageMock=function(a){this.url="",this.viewportSize={},this.id=a,this.viewportSize={width:"200",height:"100"},this.frame=null,this.urlBar=null,this.br=null},PFT.PageMock.prototype.open=function(a,b){this.url=a,this.urlBar||(this.urlBar=document.createElement("div"),this.urlBar.style.width=this.viewportSize.width+"px",this.urlBar.style.border="solid 1px black",this.urlBar.id="url"+this.id,this.urlBar.innerHTML=a,document.body.appendChild(this.urlBar),this.br=document.createElement("br"),document.body.appendChild(this.br)),this.frame||(this.frame=document.createElement("iframe"),this.frame.width=this.viewportSize.width+"px",this.frame.height=this.viewportSize.height+"px",document.body.appendChild(this.frame),this.frame.id=this.id),this.frame.onload=function(){this.onLoadFinished("success"),PFT.phantom.updatePhantomCookies(this.frame),this.frame.onload=function(){this.onLoadFinished("success"),this.urlBar.innerHTML=this.frame.contentWindow.location.href}.bind(this),this.urlBar.innerHTML=this.frame.contentWindow.location.href,b("success")}.bind(this),this.frame.src=this.url},PFT.PageMock.prototype.clearCookies=function(){try{var a=this.frame.contentDocument.cookie,b=a.split(/[\s]*;[\s]*/);for(var c in b){var d=b[c];d&&d.length>0&&this.frame&&PFT.phantom.deleteCookie(d.substring(0,d.indexOf("=")),this.frame)}PFT.phantom.updatePhantomCookies(this.frame)}catch(e){PFT.error("call to pageMock.clearCookies failed due to: "+e)}},PFT.PageMock.prototype.includeJs=function(){},PFT.PageMock.prototype.evaluate=function(a,b){var c=a.toString().replace(/function[\s]*\(s\)[\s]*\{[\s]*/,"").replace(/[\s]*\}$/,"").replace(/document./g,'document.querySelector("#'+this.id.toString()+'").contentDocument.'),d=new Function("s",c).call(window,b);return PFT.phantom.updatePhantomCookies(this.frame),d},PFT.PageMock.prototype.sendEvent=function(){},PFT.PageMock.prototype.render=function(){},PFT.PageMock.prototype.close=function(){this.url="",this.viewportSize={},document.body.removeChild(this.frame),document.body.removeChild(this.urlBar),document.body.removeChild(this.br),this.frame=null,this.urlBar=null,this.br=null},PFT.PageMock.prototype.goBack=function(){this.frame.contentWindow.history.length>2&&this.frame.contentWindow.history.back()},PFT.PageMock.prototype.onLoadFinished=function(){},PFT.COUNT=0,PFT.webpageMock={create:function(){return PFT.COUNT++,new PageMock("iframe"+PFT.COUNT.toString())}},PFT.webpage=require("webpage")||PFT.webpageMock;var PFT=PFT||{};PFT.phantomMock={injectJs:function(a){var b=document.createElement("script");b.setAttribute("src",a),document.head.appendChild(b)},exit:function(){},cookies:[],mock:!0,updatePhantomCookies:function(a){try{var b=a.contentDocument.cookie.split(/[\s]*;[\s]*/),c=[];b.forEach(function(a){var b={name:a.substring(0,a.indexOf("=")),value:a.substring(a.indexOf("=")+1,a.length)};c.push(b)}),phantom.cookies=c}catch(d){PFT.warn("could not update phantom cookies due to: "+d)}},deleteCookie:function(a,b){try{var c=new Date;c.setTime(c.getTime()-1),b.contentDocument.cookie=a+="=; expires="+c.toGMTString(),document.cookie=a+="=; expires="+c.toGMTString()}catch(d){PFT.warn("could not delete phantom cookies due to: "+d)}}},PFT.phantom=phantom||PFT.phantomMock;var PFT=PFT||{};PFT.systemMock={env:[],mock:!0},PFT.system=require("system")||PFT.systemMock;var PFT=PFT||{};PFT.Logger={logLevel:PFT.system.env.log_level||"info",UNKNOWN:-1,TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,FATAL:5,TEST:100,getLogLevelInt:function(a){switch(a.toLowerCase()){case"trace":return PFT.Logger.TRACE;case"debug":return PFT.Logger.DEBUG;case"info":return PFT.Logger.INFO;case"warn":return PFT.Logger.WARN;case"error":return PFT.Logger.ERROR;case"fatal":return PFT.Logger.FATAL;case"qunit":return PFT.Logger.TEST;default:return PFT.Logger.UNKNOWN}},getLogLevelStr:function(a){switch(a){case PFT.Logger.TRACE:return"TRACE";case PFT.Logger.DEBUG:return"DEBUG";case PFT.Logger.INFO:return"INFO";case PFT.Logger.WARN:return"WARN";case PFT.Logger.ERROR:return"ERROR";case PFT.Logger.FATAL:return"FATAL";case PFT.Logger.TEST:return"TEST";default:return"UNKNOWN"}},log:function(a,b,c){if(a>=PFT.Logger.getLogLevelInt(PFT.Logger.logLevel)){c&&(b+="\n"+PFT.Logger._getStackTrace());var d=PFT.Logger.getLogLevelStr(a)+": "+b;switch(a){case PFT.Logger.FATAL:case PFT.Logger.ERROR:console.error(d);break;case PFT.Logger.WARN:console.warn(d);break;default:console.log(d)}}},_getStackTrace:function(){var a="",b=!1;try{e.dont.exist+=0}catch(c){var d,e;if(c.stack){for(d=c.stack.split("\n"),e=2;e<d.length;e++)a+=d[e]+"\n";b=!0}}if(!b)for(var f=arguments.callee.caller;f;){var g=f.toString(),h=g.substring(g.indexOf("function")+8,g.indexOf(""))||"anonymous";a+="	"+h+"\n",f=f.caller}return a}};var PFT=PFT||{};PFT.BasePage=function(a,b){this.page=a||PFT.createPage(),this.baseUrl=b||"",this.keyElements=[],this.page.onError=function(a,b){var c=[a];b&&b.length&&b.forEach(function(a){c.push(" -> "+(a.file||a.sourceURL)+": "+a.line+(a["function"]?" (in function "+a["function"]+")":""))}),PFT.Logger.log(PFT.Logger.ERROR,c.join("\n"),!1)}},PFT.BasePage.prototype.open=function(a,b){a&&!b&&"function"==typeof a&&(b=a,a=void 0);var c=a||"";this.page.open(this.baseUrl+c,function(a){PFT.debug("opened page: "+this.baseUrl+" = "+a),"success"==a?b.call(this,!0):b.call(this,!1,"opening '"+this.baseUrl+c+"' returned: "+a)}.bind(this))},PFT.BasePage.prototype.registerKeyElement=function(a){this.keyElements.push(a)},PFT.BasePage.prototype.checkValidity=function(a){var b=this.keyElements;this._verify(b,a)},PFT.BasePage.prototype._verify=function(a,b){if(a.length>0){var c=a.shift();PFT.debug("verifying '"+c+"' exists on page..."),this.waitFor(c,function(c,d){c?a.length>0?this._verify(a,b):b.call(this,!0):b.call(this,!1,"unable to locate selector: "+d)}.bind(this),PFT.DEFAULT_TIMEOUT)}else b.call(this,!1,"nothing to verify")},PFT.BasePage.prototype.withinPage=function(a){PFT.debug("checking for: '"+a+"' within page.");try{var b=this.elementPosition(a);return b.left>=0&&b.top>=0&&b.left<=this.page.viewportSize.width&&b.top<=this.page.viewportSize.height?!0:!1}catch(c){return!1}},PFT.BasePage.prototype.visible=function(a){PFT.debug("checking for: '"+a+"' visible.");try{var b=this.eval(function(a){var b=document.querySelector(a);return"undefined"!=typeof window.getComputedStyle?window.getComputedStyle(b,null).display:"undefined"!==b.currentStyle?b.currentStyle.display:void 0},a);return"none"===b?!1:!0}catch(c){return!1}},PFT.BasePage.prototype.renderPage=function(a){a||(a=this.page.url),a=a.replace(/\//g,"_").replace(/([%:?&\[\]{}\s\W\\])/g,""),a=PFT.IMAGES_DIR+a+"."+(new Date).getTime()+".jpg",PFT.info("capturing page image: "+a),this.page.render(a,{quality:"50"})},PFT.BasePage.prototype.waitFor=function(a,b,c){PFT.debug("waiting for: '"+a+"' or until "+c+"ms has passed.");var d=(new Date).getTime()+1e4;return c&&"number"==typeof c&&(d=(new Date).getTime()+c),this.waitUntil(a,b,d)},PFT.BasePage.prototype.waitUntil=function(a,b,c){PFT.debug("waiting for: '"+a+"' or for "+(c-(new Date).getTime())+" milliseconds"),this.exists(a)?(PFT.debug("selector found."),b.call(this,!0)):(PFT.debug("selector not found."),(new Date).getTime()+PFT.POLLING_INTERVAL<c?(PFT.debug("retrying..."),setTimeout(function(){this.waitUntil(a,b,c)}.bind(this),PFT.POLLING_INTERVAL)):(PFT.info("timing out. '"+a+"' not found by: "+new Date(c)),b.call(this,!1,"'"+a+"' not found by: "+new Date(c))))},PFT.BasePage.prototype.exists=function(a){PFT.debug("checking for: '"+a+"' on page.");var b=this.eval(function(a){return null!==document.querySelector(a)},a.toString());return b?(PFT.debug("condition met."),!0):(PFT.debug("condition failed."),!1)},PFT.BasePage.prototype.elementPosition=function(a){PFT.debug("retrieving: '"+a+"' position page.");var b=this.eval(function(a){return document.querySelector(a).getBoundingClientRect()},a.toString());if(!b||void 0===b.left&&null===b.left||void 0===b.top&&null===b.top)throw"element could not be located on the page. pos: "+JSON.stringify(b);return PFT.debug("found '"+a+"' at position: "+JSON.stringify(b)),b},PFT.BasePage.prototype.click=function(a){PFT.debug("clicking on: '"+a+"'...");this.elementPosition(a);PFT.debug("using javascript click..."),this.eval(function(a){var b=document.createEvent("MouseEvent");b.initMouseEvent("click",!0,!0,window,null,0,0,0,0,!1,!1,!1,!1,0,null),document.querySelector(a).dispatchEvent(b)},a)},PFT.BasePage.prototype.getAttribute=function(a,b){return PFT.debug("returning href value for: '"+a+"'..."),this.eval(function(a,b){return document.querySelector(a).getAttribute(b)},a.toString(),b)},PFT.BasePage.prototype.sendKeys=function(a,b,c){try{if(b){var d=b.substring(0,1);PFT.trace("appending value of '"+d+"' to: '"+a+"'"),b=b.substring(1,b.length),this.eval(function(a){function b(a,b){return document.createEventObject?(c=document.createEventObject(),a.fireEvent("on"+b,c)):document.createEvent?(c=document.createEvent("HTMLEvents"),c.initEvent(b,!0,!0),!a.dispatchEvent(c)):(c=new Event(b),a.dispatchEvent(c))}var c,d=document.querySelector(a.sel);d.value=d.value+a.ch,b(d,"keydown"),b(d,"keyup"),b(d,"focus")},{sel:a,ch:d}),this.page.sendEvent("keyup",d),b.length>0?setTimeout(function(){this.sendKeys(a,b,c)}.bind(this),25):c.call(this,!0)}else c.call(this,!1,"no value passed to method: "+b)}catch(e){c.call(this,!1,e)}},PFT.BasePage.prototype.setCheckboxState=function(a,b){PFT.debug("setting state of checkbox for: '"+a+"' to: "+b),b?this.eval(function(a){document.querySelector(a).checked=!0},a.toString()):this.eval(function(a){document.querySelector(a).checked=!1},a.toString())},PFT.BasePage.prototype.eval=function(){return arguments&&arguments.length>0?(PFT.debug("evaluating '"+arguments[0]+"' in page..."),this.page.evaluate.apply(this.page,arguments)):void 0},PFT.BasePage.prototype.extend=function(a){for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b])};var PFT=PFT||{};PFT.tester={ready:!0,running:!1,testQueue:[],current:null,passes:0,failures:[],errors:[],remainingCount:0,globalStartTime:null,suite:function(a){PFT.tester.appendToExecutionQueue(a,"suite",function(){PFT.Logger.log(PFT.Logger.TEST,"Suite Started: "+a),PFT.tester.done()})},test:function(a,b,c,d){2===arguments.length&&(d=b),b&&0!==b.length||(b=[],b.push({}));for(var e=0;e<b.length;e++){var f=b[e],g=a+" - "+JSON.stringify(f);c&&c.setup&&PFT.tester.appendToExecutionQueue("Setup - "+g,"setup",f,function(a){c.setup.call(this,a)}),PFT.tester.remainingCount++,PFT.tester.appendToExecutionQueue(g,"test",f,function(a){PFT.Logger.log(PFT.Logger.TEST,"Started: "+PFT.tester.current.name),PFT.tester.onTestStarted({test:PFT.tester.current}),d.call(this,a)}),c&&c.tearDown&&PFT.tester.appendToExecutionQueue("TearDown - "+g,"teardown",f,function(a){c.tearDown.call(this,a)})}},appendToExecutionQueue:function(a,b,c,d){PFT.tester.testQueue.push({fn:d,type:b,name:a,parameters:c,passes:0,failures:[],errors:[]})},done:function(){PFT.Logger.log(PFT.Logger.TEST,"Completed: "+PFT.tester.current.name),PFT.tester.current.duration=PFT.convertMsToHumanReadable((new Date).getTime()-PFT.tester.current.startTime),PFT.tester.onTestCompleted({test:PFT.tester.current}),PFT.tester.ready=!0,"test"===PFT.tester.current.type&&PFT.tester.remainingCount--},assert:{isTrue:function(a,b){if(!a){var c=b||"expected 'true' but was 'false'";throw c="Error in: "+PFT.tester.current.name+"\n	"+c,PFT.tester.failures.push(c),PFT.tester.current.failures.push(c),PFT.Logger.log(PFT.Logger.TEST,c,!0),c}PFT.tester.passes++,PFT.tester.current.passes++},isFalse:function(a,b){PFT.tester.assert.isTrue(!a,b)}},pass:function(a){var b=a||PFT.tester.current.name;PFT.Logger.log(PFT.Logger.TEST,"PASS: "+b),PFT.tester.assert.isTrue(!0,a),PFT.tester.done()},fail:function(a){var b=a||PFT.tester.current.name;PFT.Logger.log(PFT.Logger.TEST,"FAIL: "+b,!0),PFT.tester.assert.isTrue(!1,a),PFT.tester.done()},start:function(){PFT.tester.globalStartTime=(new Date).getTime(),PFT.tester.running=!0,PFT.tester.executionLoop()},executionLoop:function(){if(PFT.tester.testQueue.length>0){if(PFT.tester.ready&&PFT.tester.running)try{PFT.tester.ready=!1;var a=PFT.tester.testQueue.shift();PFT.tester.current=a,PFT.tester.current.startTime=(new Date).getTime(),a.fn.call(this,a.parameters)}catch(b){var c="Error due to: "+b;PFT.Logger.log(PFT.Logger.TEST,c,!0),PFT.tester.errors.push(c),PFT.tester.current.errors.push(m),PFT.tester.done()}}else PFT.tester.remainingCount<1&&PFT.tester.exit();PFT.tester.running&&setTimeout(PFT.tester.executionLoop,10)},stop:function(){PFT.tester.running=!1},exit:function(){PFT.tester.stop();var a=PFT.tester.errors.length+PFT.tester.failures.length,b=PFT.convertMsToHumanReadable((new Date).getTime()-PFT.tester.globalStartTime),c="Completed in "+b+" with "+PFT.tester.passes+" passes, "+PFT.tester.failures.length+" failures, "+PFT.tester.errors.length+" errors.";PFT.Logger.log(PFT.Logger.TEST,c),setTimeout(function(){phantom.exit(a)},1e3)},onTestStarted:function(){},onTestCompleted:function(){}},phantom.onError=function(){PFT.tester.exit()},Function.prototype.bind||(Function.prototype.bind=function(a){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var b=Array.prototype.slice.call(arguments,1),c=this,d=function(){},e=function(){return c.apply(this instanceof d&&a?this:a,b.concat(Array.prototype.slice.call(arguments)))};return d.prototype=this.prototype,e.prototype=new d,e});
//# sourceMappingURL=PFT-1.0.0.min.js.map
module.exports = PFT;